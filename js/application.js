(function(){"use strict";Date.prototype.format=function(n){var t=n,i;return n||(t="yyyy-MM-dd hh:mm:ss"),i=["日","一","二","三","四","五","六"],t=t.replace(/yyyy|YYYY/,this.getFullYear()),t=t.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100),t=t.replace(/MM/,this.getMonth()>=9?(parseInt(this.getMonth())+1).toString():"0"+(parseInt(this.getMonth())+1)),t=t.replace(/M/g,parseInt(this.getMonth())+1),t=t.replace(/w|W/g,i[this.getDay()]),t=t.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate()),t=t.replace(/d|D/g,this.getDate()),t=t.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours()),t=t.replace(/h|H/g,this.getHours()),t=t.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes()),t=t.replace(/m/g,this.getMinutes()),t=t.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds()),t=t.replace(/s|S/g,this.getSeconds()),t.replace(/iii/g,this.getMilliseconds()<10?"00"+this.getMilliseconds():this.getMilliseconds()<100?"0"+this.getMilliseconds():this.getMilliseconds())},Date.prototype.DateAdd=function(n,t){var i=this;switch(n){case"s":return new Date(Date.parse(i)+1e3*t);case"n":return new Date(Date.parse(i)+6e4*t);case"h":return new Date(Date.parse(i)+36e5*t);case"d":return new Date(Date.parse(i)+864e5*t);case"w":return new Date(Date.parse(i)+6048e5*t);case"q":return new Date(i.getFullYear(),i.getMonth()+t*3,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds());case"m":return new Date(i.getFullYear(),i.getMonth()+t,i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds());case"y":return new Date(i.getFullYear()+t,i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds())}},Number.prototype.round=function(n){var t=Math.pow(10,n),i=this;return Math.round(i*t)/t},String.prototype.endsWith=function(n){return this.substr(this.length-n.length)===n},String.prototype.startsWith=function(n){return this.substr(0,n.length)===n},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.trimEnd=function(){return this.replace(/\s+$/,"")},String.prototype.trimStart=function(){return this.replace(/^\s+/,"")},Array.add=Array.enqueue=function(n,t){n[n.length]=t},Array.addRange=function(n,t){n.push.apply(n,t)},Array.clear=function(n){n.length=0},Array.clone=function(n){return n.length===1?[n[0]]:Array.apply(null,n)},Array.contains=function(n,t){return Array.indexOf(n,t)>=0},Array.dequeue=function(n){return n.shift()},Array.indexOf=function(n,t,i){var u,r;if(typeof t=="undefined")return-1;if(u=n.length,u!==0)for(i=+i,isNaN(i)?i=0:(isFinite(i)&&(i=i-i%1),i<0&&(i=Math.max(0,u+i))),r=i;r<u;r++)if(typeof n[r]!="undefined"&&n[r]===t)return r;return-1},Array.insert=function(n,t,i){n.splice(t,0,i)},Array.parse=function(n){return n?eval(n):[]},Array.remove=function(n,t){var i=Array.indexOf(n,t);return i>=0&&n.splice(i,1),i>=0},Array.removeAt=function(n,t){n.splice(t,1)}})(window),function(){function u(n){this._n=n}function f(n,t,i){var u=Math.pow(10,t),r,f;return r=(Math.round(n*u)/u).toFixed(t),i&&(f=new RegExp("0{1,"+i+"}$"),r=r.replace(f,"")),r}function e(n,t){return t.indexOf("$")>-1?c(n,t):t.indexOf("%")>-1?l(n,t):t.indexOf(":")>-1?a(n,t):y(n,t)}function h(i,u){var f,o;if(u.indexOf(":")>-1)i._n=v(u);else if(u===r)i._n=0;else{f=u,n[t].delimiters.decimal!=="."&&(u=u.replace(/\./g,"").replace(n[t].delimiters.decimal,"."));var h=new RegExp("[^a-zA-Z]"+n[t].abbreviations.thousand+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),c=new RegExp("[^a-zA-Z]"+n[t].abbreviations.million+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),l=new RegExp("[^a-zA-Z]"+n[t].abbreviations.billion+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+n[t].abbreviations.trillion+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),s=["KB","MB","GB","TB","PB","EB","ZB","YB"],e=!1;for(o=0;o<=s.length;o++)if(e=u.indexOf(s[o])>-1?Math.pow(1024,o+1):!1,e)break;i._n=(e?e:1)*(f.match(h)?Math.pow(10,3):1)*(f.match(c)?Math.pow(10,6):1)*(f.match(l)?Math.pow(10,9):1)*(f.match(a)?Math.pow(10,12):1)*(u.indexOf("%")>-1?.01:1)*Number((u.indexOf("(")>-1?"-":"")+u.replace(/[^0-9\.-]+/g,"")),i._n=e?Math.ceil(i._n):i._n}return i._n}function c(i,r){var o=r.indexOf("$")<=1?!0:!1,f="",u;return r.indexOf(" $")>-1?(f=" ",r=r.replace(" $","")):r.indexOf("$ ")>-1?(f=" ",r=r.replace("$ ","")):r=r.replace("$",""),u=e(i,r),o?u.indexOf("(")>-1||u.indexOf("-")>-1?(u=u.split(""),u.splice(1,0,n[t].currency.symbol+f),u=u.join("")):u=n[t].currency.symbol+f+u:u.indexOf(")")>-1?(u=u.split(""),u.splice(-1,0,f+n[t].currency.symbol),u=u.join("")):u=u+f+n[t].currency.symbol,u}function l(n,t){var r="",i;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),n._n=n._n*100,i=e(n,t),i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,r+"%"),i=i.join("")):i=i+r+"%",i}function a(n){var i=Math.floor(n._n/3600),t=Math.floor((n._n-i*3600)/60),r=Math.round(n._n-i*3600-t*60);return i+":"+(t<10?"0"+t:t)+":"+(r<10?"0"+r:r)}function v(n){var i=n.split(":"),t=0;return i.length===3?(t=t+Number(i[0])*3600,t=t+Number(i[1])*60,t=t+Number(i[2])):i.length===2&&(t=t+Number(i[0])*60,t=t+Number(i[1])),Number(t)}function y(i,u){var y=!1,k=!1,e="",a="",v="",c=Math.abs(i._n),b,p,d,l;if(i._n===0&&r!==null)return r;if(u.indexOf("(")>-1&&(y=!0,u=u.slice(1,-1)),u.indexOf("a")>-1&&(u.indexOf(" a")>-1?(e=" ",u=u.replace(" a","")):u=u.replace("a",""),c>=Math.pow(10,12)?(e=e+n[t].abbreviations.trillion,i._n=i._n/Math.pow(10,12)):c<Math.pow(10,12)&&c>=Math.pow(10,9)?(e=e+n[t].abbreviations.billion,i._n=i._n/Math.pow(10,9)):c<Math.pow(10,9)&&c>=Math.pow(10,6)?(e=e+n[t].abbreviations.million,i._n=i._n/Math.pow(10,6)):c<Math.pow(10,6)&&c>=Math.pow(10,3)&&(e=e+n[t].abbreviations.thousand,i._n=i._n/Math.pow(10,3))),u.indexOf("b")>-1)for(u.indexOf(" b")>-1?(a=" ",u=u.replace(" b","")):u=u.replace("b",""),b=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=0;l<=b.length;l++)if(p=Math.pow(1024,l),d=Math.pow(1024,l+1),i._n>=p&&i._n<d){a=a+b[l],p>0&&(i._n=i._n/p);break}u.indexOf("o")>-1&&(u.indexOf(" o")>-1?(v=" ",u=u.replace(" o","")):u=u.replace("o",""),v=v+n[t].ordinal(i._n)),u.indexOf("[.]")>-1&&(k=!0,u=u.replace("[.]","."));var s=i._n.toString().split(".")[0],o=u.split(".")[1],g=u.indexOf(","),h="",w=!1;return o?(o.indexOf("[")>-1?(o=o.replace("]",""),o=o.split("["),h=f(i._n,o[0].length+o[1].length,o[1].length)):h=f(i._n,o.length),s=h.split(".")[0],h=h.split(".")[1].length?n[t].delimiters.decimal+h.split(".")[1]:"",k&&Number(h.slice(1))===0&&(h="")):s=f(i._n,null),s.indexOf("-")>-1&&(s=s.slice(1),w=!0),g>-1&&(s=s.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n[t].delimiters.thousands)),u.indexOf(".")===0&&(s=""),(y&&w?"(":"")+(!y&&w?"-":"")+s+h+(v?v:"")+(e?e:"")+(a?a:"")+(y&&w?")":"")}function p(t,i){n[t]=i}var i,o="1.4.9",n={},t="en",r=null,s=typeof module!="undefined"&&module.exports;i=function(n){return i.isNumeral(n)?n=n.value():Number(n)||(n=0),new u(Number(n))},i.version=o,i.isNumeral=function(n){return n instanceof u},i.language=function(r,u){if(!r)return t;if(r&&!u){if(!n[r])throw new Error("Unknown language : "+r);t=r}return(u||!n[r])&&p(r,u),i},i.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(n){var t=n%10;return~~(n%100/10)==1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:"$"}}),i.zeroFormat=function(n){r=typeof n=="string"?n:null},i.fn=u.prototype={clone:function(){return i(this)},format:function(n){return e(this,n?n:i.defaultFormat)},unformat:function(n){return h(this,n?n:i.defaultFormat)},value:function(){return this._n},valueOf:function(){return this._n},round:function(n){return this._n.round(n)},set:function(n){return this._n=Number(n)||0,this},add:function(n){return this._n=this._n+(Number(n)||0),this},subtract:function(n){return this._n=this._n-(Number(n)||0),this},multiply:function(n){return this._n=this._n*(Number(n)||0),this},divide:function(n){return this._n=this._n/Number(n),this},difference:function(n){var t=this._n-(Number(n)||0);return t<0&&(t=-t),t}},s&&(module.exports=i),typeof ender=="undefined"&&(this.numeral=i),typeof define=="function"&&define.amd&&define([],function(){return i})}.call(this),function(){var n=function(){function n(n,i){return i===undefined?(localStorage||t)[n]:(localStorage||t)[n]=i&&typeof i!="string"?JSON.stringify(i):i}var t={};return{ViewCache:function(t,i){return n(t,i)},WebAuthKey:function(t){return n("WebAuthKey",t)},UserPhone:function(t){return n("UserPhone",t)},UserPwd:function(t){return n("UserPwd",t)},UserID:function(t){return n("UserID",t)},CompanyID:function(t){return n("CompanyID",t)},LatestUpdateOn:function(t){return n("LatestUpdateOn",t)},Version:function(t){return n("Version",t)},IsSavePwd:function(t){return n("IsSavePwd",t)},IsAutoLogin:function(t){return n("IsAutoLogin",t)},RegDate:function(t){return n("RegDate",t)}}};window.DS=n()}(window),function(){var n=function(){function t(n,t,i){return i=i||"Get",{name:n,isAuth:t,action:i}}function u(n){return app.getUrl()+"/public/RestHandler.ashx/"+n.name+"/"+n.action}function i(n,t,i){if(!app.ol()){i({code:-1,message:"网络没有连接."});return}t=t||{},n.isAuth&&(t.__t=DS.WebAuthKey());var f=u(n);r[f]||($.ajax({url:f,data:t,dataType:$D.dataType||"json",type:$D.type||"POST",cache:!1,success:function(r){if(r.code===-100&&n.isAuth){app.logout(),app.showtips(r.message);return}i(r),delete t,delete r},complete:function(){delete r[f],app.spinner(!1)},beforeSend:function(){app.spinner(!0)},error:function(){delete r[f],app.spinner(!1),app.showtips("services call errors.")}}),r[f]=!0)}var r={},f=typeof Zepto==undefined,n={Login:t("App",!1,"Login"),SendPassword:t("App",!1,"SendPassword"),Ver:t("App",!1,"GetVer"),GetOrders:t("OrderMeal",!0,"GetOrders"),GetOrderDetail:t("OrderMeal",!0,"GetDetail"),GetOrderTemps:t("OrderMeal",!0,"GetTemps"),SendOrderTemps:t("OrderMeal",!0,"SendTemps"),ConfirmOrder:t("OrderMeal",!0,"SendMessage"),FacebookQuery:t("FaceBook",!0,"Get"),ReplyFacebook:t("FaceBook",!0,"Edit"),GetMyInfo:t("User",!0,"Get"),SaveMyInfo:t("User",!0,"Edit"),GetMenus:t("MealMenu",!0,"Get"),SaveMenus:t("MealMenu",!0,"Edit"),GetItem:t("OrderMeal",!0,"GetItem"),SaveItem:t("OrderMeal",!0,"SaveItem"),GetItems:t("OrderMeal",!0,"GetItems"),GetRushItems:t("OrderMeal",!0,"GetRushItems"),DelItem:t("OrderMeal",!0,"DelItem"),GetFinance:t("App",!0,"GetFinance")};return{Login:function(t,r,u){i(n.Login,{u:t,p:r,s:2},function(n){n.code==0&&(DS.CompanyID(n.data.c),DS.UserID(n.data.id),DS.UserPhone(n.data.p),DS.WebAuthKey(n.data.t),DS.RegDate(n.data.r)),u(n)})},SendPassword:function(t,r){i(n.SendPassword,{phone:t},r)},Ver:function(){i(n.Ver,undefined,function(n){app.logInfo("current version :"+n.data),DS.Version(n.data)})},GetOrders:function(t,r){i(n.GetOrders,t,r)},OrderDetail:function(t,r){i(n.GetOrderDetail,{id:t},r)},ConfirmOrder:function(t,r){i(n.ConfirmOrder,t,r)},FacebookQuery:function(t,r){i(n.FacebookQuery,t,r)},ReplyFacebook:function(t,r){i(n.ReplyFacebook,t,r)},GetMyInfo:function(t){i(n.GetMyInfo,null,t)},SaveMyInfo:function(t,r){i(n.SaveMyInfo,t,r)},GetMenus:function(t,r){i(n.GetMenus,t,r)},SaveMenus:function(t,r){i(n.SaveMenus,t,r)},GetItem:function(t,r){i(n.GetItem,{id:t},r)},GetItems:function(t,r){i(n.GetItems,t,r)},GetRushItems:function(t,r){i(n.GetRushItems,t,r)},SaveItem:function(t,r){i(n.SaveItem,t,r)},delItem:function(t,r){i(n.DelItem,t,r)},GetFinance:function(t,r){i(n.GetFinance,t,r)},getUrl:function(t){var i=n[t];return i?u(i):null},callServices:function(t,r,u){var f=n[t];f&&i(f,r,u)}}};window.WS=new n}(),function(){var n=function(n){function h(){return $D.WIN?"MozWebSocket"in window?window.MozWebSocket:"WebSocket"in window?window.WebSocket:null:window.plugins.WebSocket}function c(){if(u&&!i){t?t.close():t=!1,i=!0;var n=new u(o);n.onopen=function(t){a(n,t)},n.onmessage=y,n.onclose=p,n.onerror=v,r.Login=function(n){app.showtips(n.message)}}}function l(){var n={Date:DS.LatestUpdateOn(),UserId:DS.UserID(),CompanyId:DS.CompanyID(),SubSys:2,LoginSys:2,Platform:app.platform(),Version:app.appVer()};e("Login",n)}function a(n){i=!1,t=n,l()}function v(n){i=!1,app.showtips(n.data)}function y(n){var t=n.data;typeof t=="string"&&(t=JSON.parse(t)),t.cmd&&r[t.cmd]&&r[t.cmd](t),delete t}function e(n,i){i=i||"",typeof i!="string"&&(i=JSON.stringify(i)),f()&&t.send(n+" "+i)}function p(){i=!1,t==!1?app.showtips("无法连接到推送服务器."):t=!1}function f(){return t&&(t.readyState==undefined||t.readyState==s.OPEN)}var o=n,s={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},t=!1,i=!1,r={},u=h();return{Inited:function(){return!(t===!1)},Connected:function(){return f()},connect:function(){f()||c()},support:function(){return u!=undefined},regCommmand:function(n,t){r[n]=t},log:function(n){n&&(typeof n!="string"&&(n=JSON.stringify(n)),e("Log",n))},close:function(){t&&t.close()}}};window.WebPusher=n}(),function(){var n=function(){function w(n){var i=e[n];return i===undefined&&(i=new window["$_"+n],e[n]=i,t[n]=i),i}function b(){r=new WebPusher($D.pusher),$D.WIN||(document.addEventListener("online",d,!1),document.addEventListener("resume",function(){p=!1,d()},!1),document.addEventListener("pause",function(){p=!0},!1),document.addEventListener("backbutton",function(){c.length>0&&f!="Login"?app.goback():app.confirm("你确定要退出程序吗?",undefined,"确定,取消",function(n){n=="1"?(r.close(),navigator.app.exitApp()):void 0})},!0),document.addEventListener("touchend",function(n){var t=n.target.nodeName.toUpperCase();if(g.indexOf(t)===-1)return n.preventDefault(),!1}),document.addEventListener("touchmove",function(n){n.preventDefault()},!1)),o=$("body"),a=(v=$("#footer",o)).find("a").bind("tap",function(n){var i=n.currentTarget.getAttribute("t");t[i].call(this,n),n.preventDefault()}),a.find("span").bind("tap",function(n){var i=n.currentTarget.parentNode.getAttribute("t");t[i].call(this,n),n.preventDefault()}),s=$("#spinner",o),l=$("#prompter",o).bind("tap",app.hideTips),DS.IsAutoLogin()&&DS.WebAuthKey()?t.showOrderList():t.showLogin(),$(window.applicationCache).bind("downloading",function(){app.showtips("正在更新程序...")}).bind("updateready",function(){this.swapCache(),app.alert("请重启应用程序.","更新完成","退出程序",function(){$D.WIN?(r.close(),document.location.reload()):(r.close(),navigator.app.exitApp())})}).bind("cached",function(){app.showtips("更新完成.")})}function nt(n){if(!app.ol()){app.logError("没有检测到网络连接.",!0);return}r.Connected()||(r.connect(),r.regCommmand("Notify",function(n){app.notify(n.data.message,n.data.title)}),n&&r.regCommmand("Order",n))}function tt(n,t,i,r){if(n.box()!==!1&&n.box()!==undefined)return!1;var u=$("<div><\/div>").addClass("hide").bind("tap",rt);return(s.before(u),n.box(u),!$.isFunction(VT[t]))?($.isFunction(n.init)&&n.init(),!1):$.isFunction(n.renderView)?(n.renderView(function(u){n.box().html(VT[t](u)),$.isFunction(n.init)&&n.init(),k(n,t,i,r)}),!0):(n.box().html(VT[t](undefined)),$.isFunction(n.init)&&n.init(),!1)}function k(n,t,i,r){var e=!1,o,s;f&&(e=w(f),$.isFunction(e.reset)?e.reset(t):void 0,r||c.push(f),u&&(u.stop(),u.release(),u=null)),o=!1,a.each(function(n,i){s=i.getAttribute("v"),s.indexOf(","+t+",")>-1?(i.className="nav_on",o=!0):i.className=""}),v.get(0).className=o?"":"hide",e?(e.box().addClass("hide"),n.box().removeClass("hide")):n.box().removeClass("hide"),$.isFunction(n.show)&&n.show(i,f),f=t}function i(n,t,i){if(n!==f){var r=w(n);tt(r,n,t,i)||k(r,n,t,i)}}function it(n){return n.indexOf(".")==-1?e[f][n]:t[n.replace("app.","")]}function rt(n){for(var t=n.target,i,r;t.nodeName!=="BODY"&&!t.hasAttribute("tap");)t=t.parentNode;i=t.getAttribute("tap"),i&&(r=it(i),$.isFunction(r)&&(r.call(t,$(t),n),n.stopImmediatePropagation(),n.preventDefault())),$.isFunction(n.cancelTouch)&&n.cancelTouch()}function d(){DS.WebAuthKey()||t.showLogin(),t.initPS()}var t=n.prototype,o,s,l,h=!1,e={},f=!1,a=!1,v=!1,y="OrderList",c=[],g=["INPUT","TEXTAREA"],u=!1,p=!1,r=!1;t.init=function(){$(document).ready(function(){$D.WIN?b():document.addEventListener("deviceready",b)})},t.iscroll=function(n,t){return t=t||{},"scrollbars"in t||(t.scrollbars=!0,t.interactiveScrollbars=!0),"useTransition"in t||(t.useTransition=!1),"HWCompositing"in t||(t.HWCompositing=!0),"useTransform"in t||(t.useTransform=!0),t.bindToWrapper=!0,new IScroll(n,t)},t.initPS=function(){nt(e[y].onPushOrder)},t.psInited=function(){return r.Inited()},t.goback=function(){var n=c.pop()||y;i(n,undefined,!0)},t.showLogin=function(n){r.close(),DS.IsAutoLogin(!1),DS.WebAuthKey(!1),i("Login",n)},t.showBalance=function(n){i("Balance",n)},t.showOrderHandle=function(n){i("OrderHandle",n)},t.showOrderList=function(n){i(y,n)},t.showDetail=function(n){i("Detail",n)},t.showMenu=function(n){i("Menu",n)},t.showHall=function(n){i("Hall",n)},t.showReview=function(n){i("Review",n)},t.showRush=function(n){i("Rush",n)},t.showRushRecord=function(n){i("RushRecord",n)},t.showSale=function(n){i("Sale",n)},t.showSaleList=function(n){i("SaleList",n)},t.showTemp=function(n){i("Temp",n)},t.logout=function(){var i,n;for(i in e)n=e[i],$.isFunction(n.reset)&&n.reset(null);c=[],t.showLogin()},t.notify=function(n,i){t.showtips((i?i+":":"")+n),$D.WIN||navigator.notification.beep(2)},t.logInfo=function(n,i){t.showtips(n),console.log(n),i&&r.log(n)},t.trace=function(n,i){t.logInfo(n,i)},t.logError=function(n){t.showtips(n),console.log(n)},t.bindDateSelector=function(n,t){if($.fn.scroller)return $("#"+n,t).scroller("destroy").scroller({preset:"date",theme:"android",mode:"scroller",display:"modal",lang:"zh",dateFormat:"yy-mm-dd"})},t.inbackground=function(){return p},t.play=function(n){u&&(u.stop(),u.release(),u=!1),n&&(u=new Media(n),u.play())},t.isCordovaApp=function(){return!$D.WIN},t.ol=function(){if($D.WIN)return navigator.onLine;var n=navigator.connection.type;return n!=Connection.UNKNOWN&&n!=Connection.NONE},t.spinner=function(n){s.get(0).className=n?"spinner top":"spinner hide"},t.hideTips=function(){l.addClass("hide").removeClass("top"),$.isFunction(h)&&(h(),h=!1)},t.showtips=function(n,t){console.log(n),$.isFunction(t)&&(h=t),l.removeClass("hide").addClass("top").text(n)},t.getUrl=function(){return $D.url},t.confirm=function(n,t,i,r){if($D.WIN){var u=confirm((t||"")+n);r(u)}else navigator.notification.confirm(n,r,t||$D.appName,i)},t.alert=function(n,t,i,r){if($D.WIN){var u=alert((t||"")+n);r(u)}else navigator.notification.alert(n,r,t||$D.appName,i)},t.cview=function(){return f},t.isSocket=function(){return r.support()},t.platform=function(){return $D.WIN?navigator.platform:device.platform},t.appVer=function(){return $D.WIN?navigator.appVersion:device.version}};window.app=new n,app.init()}(),function(){var n=function(){var r,t=!1,i=n.prototype;i.box=function(n){return n&&(t=n),t},i.renderView=function(n){var t=new Date,i=t.DateAdd("d",1-t.getDate()).format("yyyy-MM-dd");n({beginDate:i,endDate:t.format("yyyy-MM-dd")})},i.init=function(){r=$("#fList",t),app.bindDateSelector("txtDetailBeginDate",t),app.bindDateSelector("txtDetailEndDate",t)},i.reset=function(){r.html("")},i.show=function(){var n={t:0,d1:$("#txtDetailBeginDate",t).val(),d2:$("#txtDetailEndDate",t).val()};WS.GetFinance(n,function(n){r.html(n.data)})}},t=function(){var r,n=!1,u,i=t.prototype;i.box=function(t){return t&&(n=t),n},i.renderView=function(n){var t=new Date,i=t.DateAdd("d",1-t.getDate()).format("yyyy-MM-dd");n({beginDate:i,endDate:t.format("yyyy-MM-dd")})},i.init=function(){r=$("#dList",n),app.bindDateSelector("txtBalanceBeginDate",n),app.bindDateSelector("txtBalanceEndDate",n),u=app.iscroll(r.parent().get(0),{scrollbars:!1})},i.reset=function(){r.html("")},i.show=function(){var t={t:1,d1:$("#txtBalanceBeginDate",n).val(),d2:$("#txtBalanceEndDate",n).val()};WS.GetFinance(t,function(n){r.html(n.data),u.refresh()})}};window.$_Detail=n,window.$_Balance=t}(window),function(){var n=function(){function y(){t.p=s.val(),t.CompanyWorkTime=u.val(),t.OnSetSum=h.val(),t.ServiceSum=c.val(),t.CompanyProvince=l.val(),t.OrderMaxAmount=a.val(),f.val()&&(t.p1=f.val()),e.val()&&(t.p2=e.val())}var t={},s,u,h,f,e,i=!1,c,l,a,v,o,r=n.prototype;r.box=function(n){return n&&(i=n),i},r.reset=function(){o.html("")},r.show=function(){WS.GetMyInfo(function(n){t=n.data||t,t.p=DS.UserPhone(),t.CompanyWorkTime=t.CompanyWorkTime||"",t.OnSetSum=t.OnSetSum||"",o.html(VT.HallView(t)),s=$("#txtPhone",i),u=$("#txtWorkingTime",i),h=$("#txtOnSetSum",i),c=$("#txtServiceSum",i),l=$("#txtCompanyProvince",i),a=$("#txtOrderMaxAmount",i),f=$("#p1",i),e=$("#p2",i),v.refresh()})},r.init=function(){o=$("#ctHall",i),v=new IScroll(o.parent().get(0),{bounceTime:50,scrollbars:!0,interactiveScrollbars:!0})},r.addWorkingtime=function(){var t=prompt("请输入新增的营业时段,如:10:00-11:00"),n;t&&(n=u.val(),n=n?n+","+t:t,u.val(n))},r.changeStatus=function(n){t.IsSuspend?(n.attr("src","images/on.png"),t.IsSuspend=!1):(n.attr("src","images/off.png"),t.IsSuspend=!0)},r.saveMyInfo=function(){var n=s.val(),i,r;if(!n||n.length==0){app.logInfo("你的登录账号不能为空.");return}if(i=f.val(),r=e.val(),i&&i!=r){app.logInfo("你两次输入的密码不一致.");return}y(),WS.SaveMyInfo(t,function(t){t.code>-1&&DS.UserPhone(n),app.logInfo(t.message)})}};window.$_Hall=n}(window),function(){var n=function(){function h(){r<=0?(t.val("短信获取密码"),t.removeClass("gray"),t.addClass("green")):(t.val(r+c),r=r-1,setTimeout(h,1e3))}var f=!1,e=!1,o=!1,s=!1,c="秒后可重发",t=!1,r=0,u=n.prototype,i=!1;u.box=function(n){return n&&(i=n),i},u.init=function(){f=$("#txtLoginUserPhone",i),e=$("#txtLoginUserPwd",i),o=$("#cbAutoLogin",i),s=$("#cbSavePwd"),DS.IsSavePwd()&&(f.val(DS.UserPhone()),e.val(DS.UserPwd()),s.attr("checked","checked")),DS.IsAutoLogin()&&o.attr("checked","checked")},u.login=function(){var t=f.val(),n;if(!t||t.length==0){app.logError("请输入你的登录账号.");return}if(n=e.val(),!n||n.length==0){app.logError("请输入你的登录密码.");return}WS.Login(t,n,function(n){n.code==0?(s.attr("checked")&&DS.IsSavePwd(!0),o.attr("checked")&&DS.IsAutoLogin(!0),app.goback(),app.showOrderList()):app.logError(n.message)})},u.sendPassword=function(){if(t=t||$(this),!t.hasClass("gray")){var n=f.val();if(!n||n.length==0){app.logError("请输入你的登录账号.");return}WS.SendPassword(n,function(n){n.code==0?(t.removeClass("green"),t.addClass("gray"),r=60,h()):app.logError(n.message)})}},u.showSendMsn=function(){$("#sendPwd",i).toggle()}};window.$_Login=n}(window),function(){var n=function(){function l(n,i,r){var u,e;return t&&t.id==i?t:(u=n.find("#__"+i),u.length==0?(u=$("<li><h2  tap='toggleMenus' data-id='"+i+"'>"+r+"<\/h2><div id='__"+i+"' data-id='"+i+"' style='display:none'><\/div><\/li>"),n.append(u),e={s:1,i:0,d:u.find("#__"+i),v:!1,id:i,c:0},f[i]=e):(e=f[i],e.d=u),e)}function a(n,t){for(var r,u,i=0;i<t.length;i++)r=t[i],u=l(n,r.id,r.name)}function s(n){return VT.MenuItem(n)}function v(n){var r,u,e,t,c=i.attr("empty")=="1",o=c?i.clone():i,v=n.menus,h;for(n.dirs&&n.dirs.length>0&&a(o,n.dirs),t=0;t<v.length;t++)u=v[t],r=l(o,u.dirid),e=r.d.find("#_"+u.id),h=s(u),e.length==0?(r.d.append(h),r.c=r.c+1):e.replaceWith(h);if(c){i.html(o.html());for(t in f)f[t].d=i.find("#__"+t)}t>0&&i.attr("empty",0)}function h(){if(!e&&(!t||!t.s||!(t.i>=t.s))){var n={q:y(),p:t.i||1,d:t.id||0};e=!0,WS.GetMenus(n,function(n){n.code>-1&&(v(n.data),t.i=t.i+1,t.s=n.data.pageCount),u.refresh(),e=!1})}}function y(){return""}var p,i,c,o,t=!1,f,u,e,r=n.prototype;r.box=function(n){return n&&(o=n),o},r.show=function(){r.reset(),h()},r.reset=function(){f={},e=!1,t=!1,i.html("").attr("empty",1)},r.init=function(){i=$("#menuContainer",o),c=i.parent(),u=app.iscroll(c.get(0));u.on("scrollEnd",function(){t&&Math.abs(u.y)>=Math.abs(u.maxScrollY)&&h()})},r.changePrice=function(n){var t=$(n),u=numeral(t.val()).round(2),f=numeral(t.attr("data-price")).round(2),r;if(u==f){app.logInfo("新价与原价相同.");return}r={cmd:"chg",v:u,id:t.attr("data-id")},WS.SaveMenus(r,function(n){n.code>-1&&i.find("#_"+r.id).replaceWith(s(n.data))})},r.outOfStockItem=function(){var n=$(this),t={cmd:"out",v:!(n.attr("data-isout")=="true"),id:n.attr("data-id")};WS.SaveMenus(t,function(n){n.code>-1&&i.find("#_"+t.id).replaceWith(s(n.data))})},r.deleteItem=function(){var n=$(this),t={cmd:"del",id:n.attr("data-id")};WS.SaveMenus(t,function(r){if(r.code>-1){i.find("#_"+t.id).remove();var e=f[n.attr("data-dir")];e&&(e.c=e.c-1),u.refresh()}})},r.searchMenu=function(){r.show()},r.toggleMenus=function(n){if(!e){var i=f[n.attr("data-id")];i.v?(t&&i.id==t.id&&(t=!1),i.d.hide(),u.refresh(),i.v=!1):(t&&(t.d.hide(),t.v=!1),t=i,i.v=!0,i.d.show(),i.c<=0?h():u.refresh())}}};window.$_Menu=n}(window),function(){var n=function(){function g(){return{counter:{notstarted:numeral(0),inprogress:numeral(0),modified:numeral(0),urge:numeral(0),canceled:numeral(0),completed:numeral(0),all:numeral(0)},summary:{sum:numeral(0),sumok:numeral(0),sumcash:numeral(0),sumpoint:numeral(0)}}}function nt(n,t){for(var i=0;i<n.length;i++)n[i].OrderUpdateOn>t&&(t=n[i].OrderUpdateOn);return t}function w(n,i){var u,l,e,h,f=!1,a=t.attr("empty")==="1",s=a?t.clone():t,v,c,o,y;for(i&&(f=s.children().first()),v=r!=="all",c=0;c<n.length;c++){e=n[c],h=tt(e),e.status=h,u=$(VT.OrderListItem(e));for(o in e)o&&o!="ID"&&o!="status"&&u.attr("data-"+o.toLowerCase(),e[o]);v&&(r!==!1&&r!==h.status||r===!1&&h.status==="canceled")?u.hide():u.show(),l=s.find("#_"+e.ID),l.length==0?i&&f&&f.length>0?(f.before(u),f=u):(f&&f.length==0&&(f=u),s.append(u)):l.replaceWith(u)}y=s.find("li"),a&&t.html(s.html()),t.attr("empty",0),it(y)}function tt(n){var t="",i="red";return n.OrderStatus==2?t="notstarted":n.OrderStatus==3?(t="modified",i="yellow"):n.OrderStatus==4?n.OrderDateUpload>n.OrderDate&&n.MsnType!=5&&n.MsnType!=3?t="urge":(t="inprogress",i="green"):n.OrderStatus==5?(t="canceled",i="dark"):n.OrderStatus==6&&(t="completed",i=n.OrderDateDeliver>n.OrderDate?"dark":"green"),{status:t,text:d[t],cls:i}}function it(n){var t=g();n.each(function(n,i){ut(i,t)}),rt(t),delete t}function rt(n){var t,i;for(t in n.counter)$("a[data-status='"+t+"']",s).find("i").text(n.counter[t].format("0"));for(i in n.summary)$("i[data-status='"+i+"']",e).text(n.summary[i].format("0.00"));$("i[data-status='all']",e).text(n.counter.all.format("0"))}function ut(n,t){var i=n.getAttribute("data-status");t.counter[i]!=undefined&&t.counter[i].add(1),t.counter.all.add(1),t.summary.sum.add(n.getAttribute("data-ordersum")),t.summary.sumok.add(n.getAttribute("data-ordersumok")),t.summary.sumcash.add(n.getAttribute("data-orderpaycash")),t.summary.sumpoint.add(n.getAttribute("data-orderpoint"))}function ft(){return app.cview()==="OrderList"}function et(n){n!=r&&(n=="all"?(s.hide(),e.show(),$("li",t).show()):t.find("li").each(function(t,i){i.style.display=i.getAttribute("data-status")==n?"list-item":"none"}),r=n,f.refresh())}function v(n,t){if(o){t&&t();return}if(n||!(h>=l)){var r={d1:$("#txtOrderListBeginDate",i).val(),d2:$("#txtOrderListEndDate",i).val(),c:DS.CompanyID(),p:h+1,q:y.val()};n&&(r.t=DS.LatestUpdateOn()),o=!0,WS.GetOrders(r,function(i){i.code>-1?(h!=0||app.psInited()||(DS.LatestUpdateOn(nt(i.data.orders,r.d1)),app.isSocket()?app.initPS():a==0&&(a=1,b())),i.data.orders.length>0&&(w(i.data.orders,n),o=!1,n||(h++,l=i.data.pageCount)),t&&t(),ft()&&f.refresh()):app.logInfo(i.message)})}}function b(){a==1&&setTimeout(function(){v(!0,b)},5e3)}var t,k,y,i=!1,s,e,r,c,h=0,l=1,o=!1,a=0,f=!1,d={notstarted:"待处理",inprogress:"处理中",modified:"已修改",urge:"催餐中",canceled:"已取消",completed:"订餐成功"},p=["OrderHandle","Temp"],u=n.prototype;u.goback=function(){c.hide(),t.find("li").each(function(n,t){t.style.display=t.getAttribute("data-status")==="canceled"?"none":"list-item"}),r=="all"&&(s.show(),e.hide()),r=!1,f.refresh()},u.box=function(n){return n&&(i=n),i},u.reset=function(n){p.indexOf(n)===-1&&(l=1,h=0,o=!1,a=0,y.val(""),t.html("").attr("empty",1),r=!1,c.hide())},u.show=function(n,t){p.indexOf(t)===-1?(u.reset(t),v(!1)):void 0},u.init=function(){app.bindDateSelector("txtOrderListBeginDate",i),app.bindDateSelector("txtOrderListEndDate",i),t=$("#orderContainer",i),k=$(".content",i),c=$(".return",i),s=$("#s1"),e=$("#s2"),$("a",s).tap(function(){et($(this).attr("data-status")),r?c.show():void 0}),$("span",e).tap(function(){s.show(),e.hide()}),y=$("#txtOrderListUserPhone",i),f=app.iscroll(i.find(".content").get(0));f.on("scrollEnd",function(){Math.abs(f.y)>=Math.abs(f.maxScrollY)&&v(!1)})},u.onPushOrder=function(n){n.data.length>0&&(o=!0,DS.LatestUpdateOn(n.data,DS.LatestUpdateOn()),w(n.data,!0),o=!1,n.hasNew&&!$D.WIN&&navigator.notification.beep(2))},u.renderView=function(n){var t=(new Date).format("yyyy-MM-dd");n({beginDate:t,endDate:t})},u.showTempView=function(n){app.showTemp(n.attr("data-id"))},u.showHandleView=function(n){app.showOrderHandle({id:n.attr("data-id"),status:n.attr("data-status")})},u.showOrderList=function(){l=1,h=0,o=!1,t.html("").attr("empty",1),r=!1,c.hide(),f.refresh(),v(!1)}},t=function(){function b(){var t,i=numeral(0),r=0,u,f;for(f in e)t=e[f],u=t.NewPrice||t.OrderPrice,t.IsCompanyItem&&r==0&&(r=t.OrderSum),i.add((t.IsCompanyItem?t.OrderQty-1:t.OrderQty)*u);n.OrderSumOk=i.add(r).round(2),delete i}function k(n,t){if(t){var i=numeral(t.NewPrice);i.valueOf()>=0?o[n]=t.MenuName+"价格调整为"+i.format("0.00")+"元":o[n]&&delete o[n],b(),v(),delete i}}function d(n,t){if(t){var i=t.IsOutOfStock;i?s[n]=t.MenuName:s[n]&&delete s[n],v()}}function v(){var f=y(),i=p(),e=$('input[value="1"]',u).attr("data-message",""),t="",r,o;f.length>0&&(r=numeral(n.OrderSumOk).add(n.ServiceSum),t="经餐厅确认："+f.join("，")+"，您的订单总计为"+r.format("0.00")+"元。",e.eq(1).attr("data-message",t).siblings("span").html(t),delete r),i.length>0&&(t="很抱歉，"+i.join("，")+"今天暂缺，请修改后重新下单。",o="很抱歉，"+n.CompanyName+"表示，"+i.join("，")+"今天暂缺，请修改后重新下单。",e.eq(0).attr("data-message",o).siblings("span").html(t))}function y(){var n=[],t;for(t in o)n.push(o[t]);return n}function p(){var n=[],t;for(t in s)n.push(s[t]);return n}var u=!1,f=!1,e={},n={},i=t.prototype,o={},s={},c=!1,r,h,l,a,w=["canceled","completed","inprogress"];i.box=function(n){return n&&(f=n),f},i.changePrice=function(n){n=$(n);var i=n.attr("data-id"),f=parseFloat(n.val())||0,t=e[i];t&&(t.NewPrice=f,k(i,t),$('input[value="1"]',u).eq(1).attr("checked",!0),r.scrollTo(0,r.maxScrollY))},i.outOfStock=function(n){var i=n.attr("data-id"),f=n.hasClass("green"),t=e[i];t&&(f?(t.IsOutOfStock=!0,n.addClass("red").removeClass("green")):(t.IsOutOfStock=!1,n.addClass("green").removeClass("red")),d(i,t),$('input[value="1"]',u).eq(0).attr("checked",!0),r.scrollTo(0,r.maxScrollY))},i.selectMsn=function(n){n.find("input").attr("checked",!0)},i.init=function(){h=$("#cthandler",f),l=$("#cthnum",f),a=$("#cthts",f),r=app.iscroll(h.parent().get(0))},i.reset=function(){h.html(""),l.text(""),a.text("")},i.show=function(t){i.reset(),WS.OrderDetail(t.id,function(i){i.code==0?(n=i.data,l.text(n.MemberPhoneNumber).attr("href","tel:"+n.MemberPhoneNumber),a.text(n.Timespan),h.html(VT.OrderHandleView(n)),u=$("#reviewContainer",f),w.indexOf(t.status)>-1&&$("#btnReview",u).hide(),r.refresh()):app.logError(i.message)})},i.processItem=function(n){e[n.MenuId.toString()]=n},i.confirmOrder=function(){var i,r,t,f;if(c){app.logInfo("正在发送,请稍等...");return}if(i=$('input[name="msnType"]:checked',u),r=i.val(),r=="1"&&y().length==0&&p().length==0){app.logInfo("你还没有调整价信息或缺货信息.");return}if(t=i.attr("data-message"),!t||t.length==0){app.logInfo("请输入回复内容.");return}f={orderId:n.OrderId,orderSessionVal:n.orderSessionVal,msnType:r,message:t,orders:JSON.stringify(e)},c=!0,WS.ConfirmOrder(f,function(t){app.logInfo(t.message),t.code==0&&(n.orderSessionVal=t.data.orderSessionVal),c=!1})},i.toggleReview=function(){u.toggle(),r.refresh(),u.css("display")!="none"&&r.scrollTo(0,r.maxScrollY)}},i=function(){function a(i){var r,u;f&&(r=new FileUploadOptions,r.fileKey="voice",r.fileName=s,r.mimeType="media/mp3",r.params={id:h,m:i},u=new FileTransfer,u.upload(e+s,encodeURI(WS.getUrl("SendOrderTemps")),function(i){f=!1;var r=JSON.parse(i.responseText);r.code>-1&&(c(t,r.data),$("#txtMessage",n).val(""),o.refresh())},function(n){app.logError(n.source)},r))}function v(i){f?a(i):WS.callServices("SendOrderTemps",{m:i,id:h},function(i){i.code<0?app.logError(i.message):(f=!1,c(t,i.data),$("#txtMessage",n).val(""),$("#temp_review",n).hide(),o.refresh())})}function c(n,t){var i=n.find("#_"+t.id);i.length>0?i.replaceWith(VT.TempItem(t)):n.append(VT.TempItem(t))}function y(n){for(var r=t.attr("empty")==="1",u=r?t.clone():t,i=0;i<n.length;i++)c(u,n[i]);r&&t.html(u.html()),t.attr("empty",0)}function l(n){if(!app.isCordovaApp()&&n){app.logError("暂不支持此操作.");return}n?e?u||(u=new Media(e+s,function(){console.log("recordAudio():Audio Success")},function(n){console.log("recordAudio():Audio Error: "+n.code)}),u.startRecord()):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(n){e=n.root.fullPath+"/"},function(n){app.logError("获取系统目录失败:"+n.target.error.code)}):u&&(u.stopRecord(),f=u.getDuration()>=2,u.release(),u=!1)}function p(t){h=t,WS.callServices("GetOrderTemps",{id:t},function(t){t.code==0&&(y(t.data.temps),$("#phone",n).text(t.data.MemberPhoneNumber).attr("href","tel:"+t.data.MemberPhoneNumber),$("#timespan",n).text(t.data.Timespan),o.refresh())})}var r=i.prototype,n=!1,t=!1,u=!1,s="voice.wav",e=!1,f=!1,h=0,o;r.box=function(t){return t&&(n=t),n},r.show=function(n){r.reset(),p(n)},r.reset=function(){f=!1,t.html("").attr("empty",1),$("#temp_review",n).hide()},r.init=function(){t=$("#tempContainer",n),$("#recordVoice",n).bind("touchstart",function(){l(!0)}).bind("touchend",function(){l(!1)}),o=app.iscroll(t.parent().get(0),{scrollbars:!1})},r.playVoice=function(n){app.play(n.attr("voice"))},r.send=function(){var t=$("#txtMessage",n).val();t&&t.length>0?v(t):app.showtips("请输入发送内容.")},r.showqs=function(){$("#temp_review",n).toggle()},r.quickSend=function(t){$("#txtMessage",n).val(t.text()),$("#temp_review",n).toggle()}};window.$_OrderList=n,window.$_OrderHandle=t,window.$_Temp=i}(window),function(){var n=function(){function h(){if(!s){s=!0;var n={t:3,b:DS.CompanyID(),i:o+1,d1:$("#txtBeginReviewDate",u).val(),d2:$("#txtEndReviewDate",u).val()};WS.FacebookQuery(n,function(n){var l;if(n.code>-1){if(e.eq(0).text(n.data.good),e.eq(1).text(n.data.normal),e.eq(2).text(n.data.bad),n.data.html.length==0&&o==0)t.html("").attr("empty",1);else{var a=n.data.html.length/2,u=0,v=0,h="",i,y=t.attr("empty")=="1",c=y?t.clone():t;for(l=0;l<a;l++)v=n.data.html[u],h=n.data.html[u+1],i=c.find("#r"+v),i.length>0?i.replaceWith(h):(i=$(h),f.v!="all"&&(i.attr(f.t)==f.v?i.show():i.hide()),c.append(i)),u=u+2;y&&t.html(c.html()),a>0&&t.attr("empty",0)}o++,r.refresh()}s=!1})}}var t=!1,c,l=!1,e=!1,a=!1,u,o=0,r,s,f={t:"data-reply",v:"all"},i=n.prototype;i.box=function(n){return n&&(u=n),u},i.reset=function(){o=0,t.html("").attr("empty",1)},i.show=function(){i.reset(),h()},i.init=function(){t=$("#reviewList",u),c=t.parent(),e=$("#rw_number",u).find("i"),app.bindDateSelector("txtBeginReviewDate",u),app.bindDateSelector("txtEndReviewDate",u),r=app.iscroll(c.get(0));r.on("scrollEnd",function(){Math.abs(r.y)>=Math.abs(r.maxScrollY)&&h()})},i.renderView=function(n){var t=new Date,i=t.DateAdd("d",1-t.getDate()).format("yyyy-MM-dd");n({beginDate:i,endDate:t.format("yyyy-MM-dd")})},i.showReview=function(){i.reset(),h()},i.filter=function(n){var i=n.attr("data-type");t.find("li").each(function(n,t){t.style.display=t.getAttribute("data-rate")===i?"list-item":"none"}),f.t="data-rate",f.v=i,r.refresh()},i.filterR=function(n){var i=n.attr("data-type"),u=n.text();i=="all"?t.find("li").show():t.find("li").each(function(n,t){t.style.display=t.getAttribute("data-reply")===i?"list-item":"none"}),f.t="data-reply",f.v=i,r.refresh()},i.showReplyBox=function(n){$("#box"+n.attr("data-id"),t).toggle(),r.refresh()},i.replyFaceBook=function(n){var i=$("#txtbox"+n.attr("data-id"),t).val(),u;if(!i||i.length==0){app.logInfo("请输入回复内容.");return}u={fbID:n.attr("data-id"),content:encodeURIComponent(i)},WS.ReplyFacebook(u,function(n){if(n.code>=0){var f=n.data.replace("[0]",i);$("#item"+u.fbID,t).append(f).find(".rw4,.rw5").remove(),r.refresh(),app.logInfo("回复成功.")}else app.logInfo(n.message)})}};window.$_Review=n}(window),function(){var n=function(){function a(){var u=(new Date).format("yyyy-MM-dd"),o=new Date(u).DateAdd("d",7).format("yyyy-MM-dd"),n=[],t=numeral(0),r,f;return $.each(e,function(u,f){r=i.find("#_"+f),n.push(unescape(r.attr("data-name"))),t.add(r.attr("data-price"))}),f={ItemTitle:n.join("+"),ItemPoint:null,ItemNeedPay:null,ItemAmount:0,OrderFreqLimit:null,OrderSumLimit:null,ItemDate:u,ItemEndDate:o,WorkingHours:null,ItemLimit:3,ItemPic:null,ItemSum:t.value(),CompanyID:DS.CompanyID(),ItemInfo:JSON.stringify(e),ItemStatus:1,ItemID:0},delete n,delete t,delete items,f}function v(n,i,r){var u,e;return t&&t.id==i?t:(u=n.find("#__"+i),u.length==0?(u=$("<li><h2 style=\"color: #333;\" tap='toggleMenus' data-id='"+i+"'>"+r+"<\/h2><div id='__"+i+"' data-id='"+i+"' style='display:none'><\/div><\/li>"),n.append(u),e={s:1,i:0,d:u.find("#__"+i),v:!1,id:i,c:0},f[i]=e):(e=f[i],e.d=u),e)}function y(n,t){for(var r,u,i=0;i<t.length;i++)r=t[i],u=v(n,r.id,r.name)}function p(n){return VT.SaleItem(n)}function w(n){var r,u,e,t,h=i.attr("empty")=="1",o=h?i.clone():i,c=n.menus,s;for(n.dirs&&n.dirs.length>0&&y(o,n.dirs),t=0;t<c.length;t++)u=c[t],r=v(o,u.dirid),e=r.d.find("#_"+u.id),s=p(u),e.length==0?(r.d.append(s),r.c=r.c+1):e.replaceWith(s);if(h){i.html(o.html());for(t in f)f[t].d=i.find("#__"+t)}t>0&&i.attr("empty",0)}function s(){if(!o&&(!t||!t.s||!(t.i>=t.s))){var n={p:t.i||1,d:t.id||0};o=!0,WS.GetMenus(n,function(n){n.code>-1&&(w(n.data),t.i=t.i+1,t.s=n.data.pageCount),r.refresh(),o=!1})}}var i,h,c=!1,t=!1,e,f,l="Rush",r,o,u=n.prototype;u.box=function(n){return n!==undefined&&(c=n),c},u.reset=function(n){n!==l&&(f={},t=!1,i.html("").attr("empty",1),o=!1)},u.show=function(n,t){u.reset(t),e=[],i.find("input.red").removeClass("red").addClass("green"),t!==l&&s()},u.init=function(){i=$("#saleContainer"),h=i.parent(),r=app.iscroll(h.get(0));r.on("scrollEnd",function(){t&&Math.abs(r.y)>=Math.abs(r.maxScrollY)&&s()})},u.toggleSale=function(n){n.hasClass("red")?app.confirm("是否继续添加促销餐点?","促销方案","是，继续添加,不，下一步",function(t){t=="1"?(Array.remove(e,parseInt(n.attr("data-id"))),n.removeClass("red").addClass("green")):app.showRush(a())}):(e.push(parseInt(n.attr("data-id"))),n.removeClass("green").addClass("red"),app.confirm("是否继续添加促销餐点?","促销方案","是，继续添加,不，下一步",function(n){n!="1"&&app.showRush(a())}))},u.toggleMenus=function(n){if(!o){var i=f[n.attr("data-id")];i.v?(t&&i.id==t.id&&(t=!1),i.d.hide(),r.refresh(),i.v=!1):(t&&(t.d.hide(),t.v=!1),t=i,i.v=!0,i.d.show(),i.c<=0?s():r.refresh())}}},t=function(){function h(n){f=n,r.attr("src","data:image/jpeg;base64,"+n),r.show(),setTimeout(function(){e.refresh()},100)}function c(){var t,i;return(o.each(function(r,u){t=u.value,i=u.getAttribute("t"),i=="dec"?t=parseFloat(t)||0:i=="int"&&(t=parseInt(t)||0),n[u.id]=t}),n.ItemLimit=parseInt(s.find("input:checked").val()),n.ItemSum<n.ItemNeedPay)?(app.showtips("现金支付额不能大于促销总额."),!1):n.ItemPoint>=.5&&n.ItemPoint<=1.5?!0:(app.showtips("抢购积分必须在0.5-1.5之间."),!1)}var n=!1,i=!1,r,o,s,f=!1,e,u=t.prototype;u.box=function(n){return n&&(i=n),i},u.init=function(){r=$("#ItemPic",i),o=$(".input",i),s=$(".link",i),app.bindDateSelector("ItemDate",i),app.bindDateSelector("ItemEndDate",i),e=app.iscroll(i.find(".wrap").get(0),{scrollbars:!1})},u.show=function(t){n=t;var i,u;o.each(function(t,r){i=n[r.id],u=r.getAttribute("t"),i&&u=="dec"&&(i=numeral(i).format("0.00")),r.value=i||""}),i=n.ItemLimit,s.find("input[value='"+i+"']").attr("checked",!0),i=n.ItemPic,f=!1,i?(r.attr("src",i),r.show()):r.hide(),e.refresh()},u.takeaPic=function(){if(!app.isCordovaApp()){app.showtips("暂不支持此功能.");return}navigator.camera.getPicture(h,function(){e.refresh()},{quality:30,destinationType:Camera.DestinationType.DATA_URL})},u.saveItem=function(){if(c()){var t={item:JSON.stringify(n),img:f||""};WS.SaveItem(t,function(t){t.code==0&&(n=t.data,f=!1),app.showtips(t.message)})}}},i=function(){function l(t){for(var u,f=n.attr("empty")=="1",r=f?n.clone():n,i=0;i<t.length;i++)u=r.find("#_"+t[i].ItemID),u.length==0?r.append(VT.SaleListItem(t[i])):r.replaceWith(VT.SaleListItem(t[i]));f&&n.html(r.html()),i>0&&n.attr("empty",0)}function s(){if(!(u>=o)&&!e){var t={d1:$("#txtSaleListBeginDate",r).val(),d2:$("#txtSaleListEndDate",r).val(),p:u+1};e=!0,WS.GetItems(t,function(t){t.code>-1&&(u==0&&n.html("").attr("empty",1),l(t.data.items),u=u+1,o=t.data.pageCount),f.refresh(),e=!1})}}var u=0,o=1,n,c,r=!1,h=["RushRecord"],t=i.prototype,f,e;t.box=function(n){return n&&(r=n),r},t.reset=function(t){h.indexOf(t)===-1&&(u=0,o=1,e=!1,n.html("").attr("empty",1))},t.renderView=function(n){var t=new Date,i=new Date(DS.RegDate()||t).format("yyyy-MM-dd"),r=t.DateAdd("m",1).format("yyyy-MM-dd");n({beginDate:i,endDate:r})},t.init=function(){n=$("#saleList",r),c=n.parent(),app.bindDateSelector("txtSaleListBeginDate",r),app.bindDateSelector("txtSaleListEndDate",r),f=app.iscroll(n.parent().get(0));f.on("scrollEnd",function(){Math.abs(f.y)>=Math.abs(f.maxScrollY)&&s()})},t.show=function(n,t){h.indexOf(t)===-1&&s()},t.showSaleList=function(){t.reset(),s()},t.showRush=function(n){WS.GetItem(n.attr("data-id"),function(n){n.code>-1?app.showRush(n.data):app.showtips(n.message)})},t.chgStatus=function(n){WS.delItem({id:n.attr("data-id"),t:"a"},function(t){if(t.code>-1){var i=n.attr("data-status")!=="true";n.text(i?"正常":"停止"),n.get(0).className=i?"t_green":"t_red",n.attr("data-status",i)}})},t.delItem=function(t){WS.delItem({id:t.attr("data-id")},function(i){i.code>-1&&(n.find("#_"+t.attr("data-id")).remove(),f.refresh()),app.showtips(i.message)})}},r=function(){function y(t){for(var i,r,e=n.attr("empty")==="1",f=e?n.clone():n,u=0;u<t.length;u++)i=t[u],r=f.find("#_"+i.ItemID),r.length>0?(s.subtract(r.attr("data-qty")).add(1),h.subtract(r.attr("data-point")).add(i.ItemPoint),r.replaceWith(VT.RushRecordItem(i))):(s.add(i.ItemQty),h.add(i.PointSum),f.append(VT.RushRecordItem(i)));e&&n.html(f.html()),u>0&&n.attr("empty",0),l.text(s.format("0")),a.text(h.format("0.00"))}function c(){if(!(u>=o)&&!e){var i={d1:$("#txtRushRecordBeginDate",t).val(),d2:$("#txtRushRecordEndDate",t).val(),p:u+1};e=!0,WS.GetRushItems(i,function(t){t.code>-1&&(u==0&&n.html("").attr("empty",1),y(t.data.items),u=u+1,o=t.data.pageCount),f.refresh(),e=!1})}}var u=0,o=1,n,v,l,a,t=!1,s=numeral(0),h=numeral(0),f,e,i=r.prototype;i.box=function(n){return n&&(t=n),t},i.reset=function(){n.html("").attr("empty",1),o=1,u=0,e=!1},i.renderView=function(n){var t=new Date,i=new Date(DS.RegDate()||t).format("yyyy-MM-dd");n({beginDate:i,endDate:t.format("yyyy-MM-dd")})},i.init=function(){n=$("#rushList",t),v=n.siblings(),app.bindDateSelector("txtRushRecordBeginDate",t),app.bindDateSelector("txtRushRecordEndDate",t),l=$("#amountSum",t),a=$("#pointSum",t),f=app.iscroll(n.parent().get(0));f.on("scrollEnd",function(){Math.abs(f.y)>=Math.abs(f.maxScrollY)&&c()})},i.show=function(){i.reset(),c()},i.showRushList=function(){i.reset(),c()}};window.$_Sale=n,window.$_Rush=t,window.$_SaleList=i,window.$_RushRecord=r}(window)