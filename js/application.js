(function(){Date.prototype.format=function(n){var t=n,i;return n||(t="yyyy-MM-dd hh:mm:ss"),i=["日","一","二","三","四","五","六"],t=t.replace(/yyyy|YYYY/,this.getFullYear()),t=t.replace(/yy|YY/,this.getYear()%100>9?(this.getYear()%100).toString():"0"+this.getYear()%100),t=t.replace(/MM/,this.getMonth()>=9?(parseInt(this.getMonth())+1).toString():"0"+(parseInt(this.getMonth())+1)),t=t.replace(/M/g,parseInt(this.getMonth())+1),t=t.replace(/w|W/g,i[this.getDay()]),t=t.replace(/dd|DD/,this.getDate()>9?this.getDate().toString():"0"+this.getDate()),t=t.replace(/d|D/g,this.getDate()),t=t.replace(/hh|HH/,this.getHours()>9?this.getHours().toString():"0"+this.getHours()),t=t.replace(/h|H/g,this.getHours()),t=t.replace(/mm/,this.getMinutes()>9?this.getMinutes().toString():"0"+this.getMinutes()),t=t.replace(/m/g,this.getMinutes()),t=t.replace(/ss|SS/,this.getSeconds()>9?this.getSeconds().toString():"0"+this.getSeconds()),t=t.replace(/s|S/g,this.getSeconds()),t.replace(/iii/g,this.getMilliseconds()<10?"00"+this.getMilliseconds():this.getMilliseconds()<100?"0"+this.getMilliseconds():this.getMilliseconds())},Number.prototype.round=function(n){var t=Math.pow(10,n),i=this;return Math.round(i*t)/t},String.prototype.endsWith=function(n){return this.substr(this.length-n.length)===n},String.prototype.startsWith=function(n){return this.substr(0,n.length)===n},String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")},String.prototype.trimEnd=function(){return this.replace(/\s+$/,"")},String.prototype.trimStart=function(){return this.replace(/^\s+/,"")},Array.add=Array.enqueue=function(n,t){n[n.length]=t},Array.addRange=function(n,t){n.push.apply(n,t)},Array.clear=function(n){n.length=0},Array.clone=function(n){return n.length===1?[n[0]]:Array.apply(null,n)},Array.contains=function(n,t){return Array.indexOf(n,t)>=0},Array.dequeue=function(n){return n.shift()},Array.indexOf=function(n,t,i){var u,r;if(typeof t=="undefined")return-1;if(u=n.length,u!==0)for(i=+i,isNaN(i)?i=0:(isFinite(i)&&(i=i-i%1),i<0&&(i=Math.max(0,u+i))),r=i;r<u;r++)if(typeof n[r]!="undefined"&&n[r]===t)return r;return-1},Array.insert=function(n,t,i){n.splice(t,0,i)},Array.parse=function(n){return n?eval(n):[]},Array.remove=function(n,t){var i=Array.indexOf(n,t);return i>=0&&n.splice(i,1),i>=0},Array.removeAt=function(n,t){n.splice(t,1)}})(window),function(n,t){$.fn.lazyload=function(i){var f=this,r={load:null},u=!1;return $.extend(r,i),$(n).bind("scroll",function(){!u&&r.load&&$(n).scrollTop()==$(t).height()-$(n).height()&&r.load()}),this}}(window,document),function(){function u(n){this._n=n}function f(n,t,i){var u=Math.pow(10,t),r,f;return r=(Math.round(n*u)/u).toFixed(t),i&&(f=new RegExp("0{1,"+i+"}$"),r=r.replace(f,"")),r}function e(n,t){return t.indexOf("$")>-1?c(n,t):t.indexOf("%")>-1?l(n,t):t.indexOf(":")>-1?a(n,t):y(n,t)}function h(i,u){var f,o;if(u.indexOf(":")>-1)i._n=v(u);else if(u===r)i._n=0;else{f=u,n[t].delimiters.decimal!=="."&&(u=u.replace(/\./g,"").replace(n[t].delimiters.decimal,"."));var h=new RegExp("[^a-zA-Z]"+n[t].abbreviations.thousand+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),c=new RegExp("[^a-zA-Z]"+n[t].abbreviations.million+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),l=new RegExp("[^a-zA-Z]"+n[t].abbreviations.billion+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),a=new RegExp("[^a-zA-Z]"+n[t].abbreviations.trillion+"(?:\\)|(\\"+n[t].currency.symbol+")?(?:\\))?)?$"),s=["KB","MB","GB","TB","PB","EB","ZB","YB"],e=!1;for(o=0;o<=s.length;o++)if(e=u.indexOf(s[o])>-1?Math.pow(1024,o+1):!1,e)break;i._n=(e?e:1)*(f.match(h)?Math.pow(10,3):1)*(f.match(c)?Math.pow(10,6):1)*(f.match(l)?Math.pow(10,9):1)*(f.match(a)?Math.pow(10,12):1)*(u.indexOf("%")>-1?.01:1)*Number((u.indexOf("(")>-1?"-":"")+u.replace(/[^0-9\.-]+/g,"")),i._n=e?Math.ceil(i._n):i._n}return i._n}function c(i,r){var o=r.indexOf("$")<=1?!0:!1,f="",u;return r.indexOf(" $")>-1?(f=" ",r=r.replace(" $","")):r.indexOf("$ ")>-1?(f=" ",r=r.replace("$ ","")):r=r.replace("$",""),u=e(i,r),o?u.indexOf("(")>-1||u.indexOf("-")>-1?(u=u.split(""),u.splice(1,0,n[t].currency.symbol+f),u=u.join("")):u=n[t].currency.symbol+f+u:u.indexOf(")")>-1?(u=u.split(""),u.splice(-1,0,f+n[t].currency.symbol),u=u.join("")):u=u+f+n[t].currency.symbol,u}function l(n,t){var r="",i;return t.indexOf(" %")>-1?(r=" ",t=t.replace(" %","")):t=t.replace("%",""),n._n=n._n*100,i=e(n,t),i.indexOf(")")>-1?(i=i.split(""),i.splice(-1,0,r+"%"),i=i.join("")):i=i+r+"%",i}function a(n){var i=Math.floor(n._n/3600),t=Math.floor((n._n-i*3600)/60),r=Math.round(n._n-i*3600-t*60);return i+":"+(t<10?"0"+t:t)+":"+(r<10?"0"+r:r)}function v(n){var i=n.split(":"),t=0;return i.length===3?(t=t+Number(i[0])*3600,t=t+Number(i[1])*60,t=t+Number(i[2])):i.length===2&&(t=t+Number(i[0])*60,t=t+Number(i[1])),Number(t)}function y(i,u){var y=!1,k=!1,e="",a="",v="",c=Math.abs(i._n),b,p,d,l;if(i._n===0&&r!==null)return r;if(u.indexOf("(")>-1&&(y=!0,u=u.slice(1,-1)),u.indexOf("a")>-1&&(u.indexOf(" a")>-1?(e=" ",u=u.replace(" a","")):u=u.replace("a",""),c>=Math.pow(10,12)?(e=e+n[t].abbreviations.trillion,i._n=i._n/Math.pow(10,12)):c<Math.pow(10,12)&&c>=Math.pow(10,9)?(e=e+n[t].abbreviations.billion,i._n=i._n/Math.pow(10,9)):c<Math.pow(10,9)&&c>=Math.pow(10,6)?(e=e+n[t].abbreviations.million,i._n=i._n/Math.pow(10,6)):c<Math.pow(10,6)&&c>=Math.pow(10,3)&&(e=e+n[t].abbreviations.thousand,i._n=i._n/Math.pow(10,3))),u.indexOf("b")>-1)for(u.indexOf(" b")>-1?(a=" ",u=u.replace(" b","")):u=u.replace("b",""),b=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],l=0;l<=b.length;l++)if(p=Math.pow(1024,l),d=Math.pow(1024,l+1),i._n>=p&&i._n<d){a=a+b[l],p>0&&(i._n=i._n/p);break}u.indexOf("o")>-1&&(u.indexOf(" o")>-1?(v=" ",u=u.replace(" o","")):u=u.replace("o",""),v=v+n[t].ordinal(i._n)),u.indexOf("[.]")>-1&&(k=!0,u=u.replace("[.]","."));var s=i._n.toString().split(".")[0],o=u.split(".")[1],g=u.indexOf(","),h="",w=!1;return o?(o.indexOf("[")>-1?(o=o.replace("]",""),o=o.split("["),h=f(i._n,o[0].length+o[1].length,o[1].length)):h=f(i._n,o.length),s=h.split(".")[0],h=h.split(".")[1].length?n[t].delimiters.decimal+h.split(".")[1]:"",k&&Number(h.slice(1))===0&&(h="")):s=f(i._n,null),s.indexOf("-")>-1&&(s=s.slice(1),w=!0),g>-1&&(s=s.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+n[t].delimiters.thousands)),u.indexOf(".")===0&&(s=""),(y&&w?"(":"")+(!y&&w?"-":"")+s+h+(v?v:"")+(e?e:"")+(a?a:"")+(y&&w?")":"")}function p(t,i){n[t]=i}var i,o="1.4.9",n={},t="en",r=null,s=typeof module!="undefined"&&module.exports;i=function(n){return i.isNumeral(n)?n=n.value():Number(n)||(n=0),new u(Number(n))},i.version=o,i.isNumeral=function(n){return n instanceof u},i.language=function(r,u){if(!r)return t;if(r&&!u){if(!n[r])throw new Error("Unknown language : "+r);t=r}return(u||!n[r])&&p(r,u),i},i.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(n){var t=n%10;return~~(n%100/10)==1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},currency:{symbol:"$"}}),i.zeroFormat=function(n){r=typeof n=="string"?n:null},i.fn=u.prototype={clone:function(){return i(this)},format:function(n){return e(this,n?n:i.defaultFormat)},unformat:function(n){return h(this,n?n:i.defaultFormat)},value:function(){return this._n},valueOf:function(){return this._n},round:function(n){return this._n.round(n)},set:function(n){return this._n=Number(n)||0,this},add:function(n){return this._n=this._n+(Number(n)||0),this},subtract:function(n){return this._n=this._n-(Number(n)||0),this},multiply:function(n){return this._n=this._n*(Number(n)||0),this},divide:function(n){return this._n=this._n/Number(n),this},difference:function(n){var t=this._n-(Number(n)||0);return t<0&&(t=-t),t}},s&&(module.exports=i),typeof ender=="undefined"&&(this.numeral=i),typeof define=="function"&&define.amd&&define([],function(){return i})}.call(this),function(){var n=function(){function n(n,t){return t===undefined?localStorage[n]:localStorage[n]=typeof t!="string"?JSON.stringify(t):t}return{ViewCache:function(t,i){return n(t,i)},WebAuthKey:function(t){return n("EleoooWebAuthKey",t)},UserPhone:function(t){return n("EleoooUserPhone",t)},UserPwd:function(t){return n("EleoooUserPwd",t)},UserID:function(t){return n("EleoooUserID",t)},CompanyID:function(t){return n("EleoooCompanyID",t)},LatestUpdateOn:function(t){return n("EleoooLatestUpdateOn",t)},Version:function(t){return n("EleoooVersion",t)},IsSavePwd:function(t){return n("EleoooIsSavePwd",t)},IsAutoLogin:function(t){return n("EleoooIsAutoLogin",t)}}};window.DataStorage=n()}(window),function(){var n=function(){function t(n,t,i){return i=i||"Get",{name:n,isAuth:t,action:i}}function u(n){return app.getServicesUrl()+n.name+"/"+n.action}function i(n,t,i){if(!app.hasNetwork()){i({code:-1,message:"No network connect."});return}t=t||{},n.isAuth&&(t.__t=DataStorage.WebAuthKey()),t.__=(new Date).valueOf();var f=u(n);r[f]||($.ajax({url:f,data:t,dataType:"jsonp",success:i,complete:function(){delete r[f],app.spinner(!1)},beforeSend:function(){app.spinner(!0)}}),r[f]=!0)}var r={},n={Login:t("App",!1,"Login"),SendPassword:t("App",!1,"SendPassword"),Version:t("App",!1,"Version"),GetOrders:t("OrderMeal",!0,"GetOrders"),GetOrderDetail:t("OrderMeal",!0,"GetDetail"),GetOrderTemps:t("OrderMeal",!0,"GetTemps"),SendOrderTemps:t("OrderMeal",!0,"SendTemps"),ConfirmOrder:t("OrderMeal",!0,"SendMessage"),FacebookQuery:t("FaceBook",!0,"Get"),ReplyFacebook:t("FaceBook",!0,"Edit"),GetMyInfo:t("User",!0,"Get"),SaveMyInfo:t("User",!0,"Edit"),GetMenus:t("MealMenu",!0,"Get"),SaveMenus:t("MealMenu",!0,"Edit")};return{Login:function(t,r,u){i(n.Login,{u:t,p:r,s:2},function(n){n.code==0&&(DataStorage.CompanyID(n.data.c),DataStorage.UserID(n.data.id),DataStorage.UserPhone(n.data.p),DataStorage.WebAuthKey(n.data.t)),u(n)})},Version:function(t){i(n.Version,{},t)},SendPassword:function(t,r){i(n.SendPassword,{userPhone:t},r)},GetOrders:function(t,r){i(n.GetOrders,t,r)},OrderDetail:function(t,r){i(n.GetOrderDetail,{id:t},r)},ConfirmOrder:function(t,r){i(n.ConfirmOrder,t,r)},FacebookQuery:function(t,r){i(n.FacebookQuery,t,r)},ReplyFacebook:function(t,r){i(n.ReplyFacebook,t,r)},GetMyInfo:function(t){i(n.GetMyInfo,null,t)},SaveMyInfo:function(t,r){i(n.SaveMyInfo,t,r)},GetMenus:function(t,r){i(n.GetMenus,t,r)},SaveMenus:function(t,r){i(n.SaveMenus,t,r)},getUrl:function(t){var i=n[t];return i?u(i):null},callServices:function(t,r,u){var f=n[t];f&&i(f,r,u)}}};window.EleoooWrapper=new n}(),function(){var n=function(n){function o(){var n="MozWebSocket"in window?"MozWebSocket":"WebSocket"in window?"WebSocket":null;n||(t=new window[n](f),t.onopen=h,t.onmessage=c,t.onclose=l)}function s(){u("Login-"+DataStorage.WebAuthKey(),{date:DataStorage.LatestUpdateOn()})}function h(){setTimeout(s,100)}function c(n){var t=n.data;typeof t=="string"&&(t=JSON.parse(t)),t.cmd&&i[t.cmd]&&i[t.cmd](t)}function u(n,i){i=i||"",typeof i!="string"&&(i=JSON.stringify(i)),r()&&t.send(n+" "+i)}function l(){t=!1}function r(){return t&&t.readyState==e.OPEN}var f=n,e={CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3},t=!1,i={};return{Inited:function(){return!(t===!1)},Connected:function(){return r()},connect:function(){r()||o()},regCommmand:function(n,t){i[n]=t},log:function(n){n&&(typeof n!="string"&&(n=JSON.stringify(n)),u("Log",n))}}};window.PushServices=n}(),function(){var n=function(){function d(n){$.isPlainObject(i[n])||(i[n]=eval("new $_"+n+"()"),t[n]=i[n])}function b(){c=new PushServices(y.pusher),h=$("#mainContainer").tap(k),o=$("#dlgContainer").tap(k),(s=$("#footer")).find("a").tap(function(){var t=$(this),n,i;t.hasClass("nav_on")||($(".nav_on",s).removeClass("nav_on"),t.addClass("nav_on"),n=t.attr("view"),n&&(i=n.charAt(0),n=n.replace(i,i.toUpperCase()),u(n)))}),v=$("#spinner"),l=$("#prompter"),DataStorage.IsAutoLogin()&&DataStorage.WebAuthKey()?s.find("a[view='orderList']").trigger("tap"):t.showLoginView()}function g(n){if(!app.hasNetwork()){app.logError("没有检测到网络连接.",!0);return}c.connect(),c.regCommmand("Admin",app.notify),n&&c.regCommmand("Order",n)}function u(n){if($(window).unbind("scroll"),d(n),$.isFunction(VT[n]))if(i[n]&&$.isFunction(i[n].renderView))i[n].renderView(function(t){if(r){if($.isFunction(i[r].onClose))i[r].onClose(n);i[r].visible=!1}if((app.isDlgView(n)?(h.hide(),s.hide(),o):(o.hide(),s.show(),h)).html(VT[n](t)).show(),i[n].visible=!0,f=r,r=n,i[n]&&$.isFunction(i[n].onLoad))i[n].onLoad(!1)});else{if(r){if($.isFunction(i[r].onClose))i[r].onClose(n);i[r].visible=!1}if((app.isDlgView(n)?(h.hide(),s.hide(),o):(o.hide(),s.show(),h)).html(VT[n](undefined)).show(),f=r,r=n,i[n].visible=!0,i[n]&&$.isFunction(i[n].onLoad))i[n].onLoad(!1)}}function nt(n){return n.indexOf(".")==-1?i[r][n]:eval(n)}function k(n){var t=$(n.target),i,r;t.attr("id")!=it().attr("id")&&(i=t.attr(n.type)||(t=t.parent("[tap]"),t.attr(n.type)),i&&(r=nt(i),$.isFunction(r)&&r.call(t,t,n)))}function tt(){app.initWS()}function it(){return app.isDlgView(r)?o:h}var t=n.prototype,h,o,v,l,y,i={},r=!1,s=!1,p="OrderList",w,f=!1,e=!1,a=!1,c=!1;t.init=function(n){y=n,a=!(typeof cordova=="undefined"),a?(document.addEventListener("deviceready",b),document.addEventListener("online",tt,!1)):$(document).ready(b)},t.isDlgView=function(n){return n&&i[n].isDlgView!=undefined&&i[n].isDlgView==!0},t.currentOrderId=function(n){return n===undefined?w:w=n},t.initWS=function(){g(i[p].onPushOrder)},t.wsInited=function(){return c.Inited()},t.closeDlg=function(){if(f){if(i[f].visible=!0,$.isFunction(i[r].onClose))i[r].onClose(f);if(i[r].visible=!1,$.isFunction(i[f].onLoad))i[f].onLoad(!0);var n=r;r=f,f=n}else f=r,i[f].visible=!1;return h.show(),s.show(),e&&(e.stop(),e.release(),e=null),o.hide(),o.html(""),!1},t.showLoginView=function(){u("Login")},t.showBalanceView=function(){u("Balance")},t.showOrderHandleView=function(){u("OrderHandle")},t.showOrderListView=function(){u(p)},t.showDetailView=function(){return u("Detail"),!1},t.showMenuView=function(){return u("Menu"),!1},t.showHallView=function(){return u("Hall"),!1},t.showReviewView=function(){return u("Review"),!1},t.showRushView=function(){return u("Rush"),!1},t.showRushRecordView=function(){return u("RushRecord"),!1},t.showSaleView=function(){return u("Sale"),!1},t.showSaleListView=function(){return u("SaleList"),!1},t.showTempView=function(){return u("Temp"),!1},t.logout=function(){t.showLoginView()},t.notify=function(n){console.log(n)},t.logInfo=function(n,t){console.log(n),t||c.log(n)},t.trace=function(n,i){t.logInfo(n,i)},t.logError=function(n){console.log(n)},t.bindDateSelector=function(n){$("#"+n).scroller("destroy").scroller({preset:"date",theme:"android",mode:"scroller",display:"modal",lang:"zh",dateFormat:"yy-mm-dd"})},t.play=function(n){e&&(e.stop(),e.release(),e=!1),n&&(e=new Media(n),e.play())},t.isCordovaApp=function(){return a},t.hasNetwork=function(){if(a){var n=navigator.connection.type;return n!=Connection.UNKNOWN&&n!=Connection.NONE}return!0},t.spinner=function(n){n?v.show():v.hide()},t.showtips=function(n,t){l.unbind("tap"),$.isFunction(t)&&l.bind("tap",t),l.text(n).show().animate({opacity:"100"},400,null,function(){setTimeout(function(){l.css({opacity:"0"}).hide()},2e3)})},t.getServicesUrl=function(){return y.servicesUrl}};window.app=new n,app.init({appName:"乐多分管理系统",pusher:"ws://192.168.0.104:8080/",servicesUrl:"http://www.eleooo.com/public/RestHandler.ashx/"})}(window),function(){var n=function(){function s(){t.p=e.val(),t.CompanyWorkTime=r.val(),t.OnSetSum=o.val(),u.val()&&(t.p1=u.val()),f.val()&&(t.p2=f.val())}var t={},e,r,o,u,f,i=n.prototype;i.isDlgView=!0,i.onLoad=function(){e=$("#txtPhone"),r=$("#txtWorkingTime"),o=$("#txtOnSetSum"),u=$("#p1"),f=$("#p2")},i.onClose=function(){s(),delete t.p1,delete t.p2,DataStorage.ViewCache("Hall",t)},i.renderView=function(n){if(!app.hasNetwork()){t=DataStorage.ViewCache("Hall")||t,t.p=DataStorage.UserPhone(),n(t);return}EleoooWrapper.GetMyInfo(function(i){t=i.data||t,t.p=DataStorage.UserPhone(),t.CompanyWorkTime=t.CompanyWorkTime||"",t.OnSetSum=t.OnSetSum||"",n(t)})},i.addWorkingtime=function(){var t=prompt("请输入新营业时间,格式如:10:00-11:00"),n;t&&(n=r.val(),n=n?n+","+t:t,r.val(n))},i.changeStatus=function(n){t.IsSuspend?(n.attr("src","images/on.png"),t.IsSuspend=!1):(n.attr("src","images/off.png"),t.IsSuspend=!0)},i.saveMyInfo=function(){var n=e.val(),i,r;if(!n||n.length==0){app.logInfo("你的登录账号不能为空.");return}if(i=u.val(),r=f.val(),i&&i!=r){app.logInfo("你两次输入的密码不一致.");return}s(),EleoooWrapper.SaveMyInfo(t,function(t){t.code>-1&&DataStorage.UserPhone(n),app.logInfo(t.message)})}};window.$_Hall=n}(window),function(){var n=function(){function s(){i<=0?(t.val("短信获取密码"),t.removeClass("gray"),t.addClass("green")):(t.val(i+h),i=i-1,setTimeout(s,1e3))}var u=!1,f=!1,e=!1,o=!1,h="秒后可重发",t=!1,i=0,r=n.prototype;r.isDlgView=!0,r.onLoad=function(){u=$("#txtLoginUserPhone").val("13800100712"),f=$("#txtLoginUserPwd").val("123456"),e=$("#cbAutoLogin"),o=$("#cbSavePwd"),DataStorage.IsSavePwd()&&(u.val(DataStorage.UserPhone()),f.val(DataStorage.UserPwd()),o.attr("checked","checked")),DataStorage.IsAutoLogin()&&e.attr("checked","checked")},r.login=function(){var t=u.val(),n;if(!t||t.length==0){app.logError("请输入你的登录账号.");return}if(n=f.val(),!n||n.length==0){app.logError("请输入你的登录密码.");return}EleoooWrapper.Login(t,n,function(n){n.code==0?(o.attr("checked")&&DataStorage.IsSavePwd(!0),e.attr("checked")&&DataStorage.IsAutoLogin(!0),app.closeDlg(),app.showOrderListView()):app.logError(n.message)})},r.sendPassword=function(){if(t=t||$(this),!t.hasClass("gray")){var n=u.val();if(!n||n.length==0){app.logError("请输入你的登录账号.");return}EleoooWrapper.SendPassword(n,function(n){n.code==0?(t.removeClass("green"),t.addClass("gray"),i=60,s()):app.logError(n.message)})}},r.showSendMsn=function(){$("#sendPwd").toggle()}};window.$_Login=n}(window),function(){var n=function(){function h(n,r){return i&&i.attr("id")==n?i:(i=$("#"+n,t),i.length==0&&(i=$("<li id='"+n+"'><h2>"+r+"<\/h2><\/li>"),t.append(i)),i)}function e(n){return VT.MenuItem(n)}function c(n){var u,t,f,r;for(i=!1,r=0;r<n.length;r++)t=n[r],u=h(t.DirID,t.DirName),f=u.find("#_"+t.ID),f.length==0?u.append(e(t)):f.replaceWith(e(t))}function s(){var n={q:l(),p:r++};EleoooWrapper.GetMenus(n,function(n){r==0&&t.find("li").remove(),n.code>-1&&(c(n.data.menus),r++,f=n.data.pageCount)})}function l(){var n=o.val();return n==o.attr("defVal")?"":n}var r=0,f=1,o,t,i=!1,u=n.prototype;u.onLoad=function(){if(o=$("#txtMenuName").focusin(function(){$(this).val()==$(this).attr("defVal")&&$(this).val("")}).focusout(function(){$(this).val()==""&&$(this).val($(this).attr("defVal"))}),t=$("#menuContainer"),app.hasNetwork())s();else{var n=JSON.parse(DataStorage.ViewCache("Menu")||"{}");n.menus&&t.html(n.menus),r=n.pageIndex||0,f=n.pageCount||1}t.lazyload({load:s})},u.onClose=function(){var n={pageIndex:r,pageCount:f,menus:t.html()};DataStorage.ViewCache("Menu",n),delete n},u.changePrice=function(){var n=$(this),r=Number.round(parseFloat(n.val())||0,2),u=Number.round(parseFloat(n.attr("data-price"))||0,2),i;if(r==u){app.logInfo("新价与原价相同.");return}i={cmd:"chg",v:r,id:n.attr("data-id")},EleoooWrapper.SaveMenus(i,function(n){n.code>-1&&t.find("#_"+i.id).replaceWith(e(n.data))})},u.outOfStockItem=function(){var n=$(this),i={cmd:"out",v:!(n.attr("data-isout")=="true"),id:n.attr("data-id")};EleoooWrapper.SaveMenus(i,function(n){n.code>-1&&t.find("#m"+i.id).replaceWith(e(n.data))})},u.deleteItem=function(){var i=$(this),n={cmd:"del",id:i.attr("data-id")};EleoooWrapper.SaveMenus(n,function(i){i.code>-1&&t.find("#m"+n.id).remove()})},u.searchMenu=function(){f=1,r=0,s()}};window.$_Menu=n}(window),function(){var n=function(){function y(){return{counter:{notstarted:numeral(0),inprogress:numeral(0),modified:numeral(0),urge:numeral(0),canceled:numeral(0),completed:numeral(0),all:numeral(0)},summary:{sum:numeral(0),sumok:numeral(0),sumcash:numeral(0),sumpoint:numeral(0)}}}function l(n,i){var o,s,l,r,v,h,e,c;for(!i&&u==0&&t&&t.html(""),o=t||f,h=0;h<n.length;h++){r=n[h],r.status=b(r),s=$(VT.OrderListItem(r));for(e in r)e&&e!="ID"&&e!="status"&&s.attr("data-"+e.toLowerCase(),r[e]);l=o.find("#_"+r.ID),l.length==0?o.append(s):l.replaceWith(s)}c=o.find("li"),c.remove().sort(function(n,t){return parseInt(t.getAttribute("data-id"))-parseInt(n.getAttribute("data-id"))}),o.append(c),t&&a(c)}function b(n){var t="",i="red";return n.OrderStatus==2?t="notstarted":n.OrderStatus==3?(t="modified",i="yellow"):n.OrderStatus==4?n.OrderDateUpload>n.OrderDate?t="urge":(t="inprogress",i="green"):n.OrderStatus==5?(t="canceled",t="dark"):n.OrderStatus==6&&(t="completed",t="dark"),{status:t,text:w[t],"class":i}}function a(n){var t=y();n.each(function(n,i){v(i,t)}),p(t),delete t}function p(n){var t,i;for(t in n.counter)$("a[data-status='"+t+"']",e).find("i").text(n.counter[t].format("0"));for(i in n.summary)$("i[data-status='"+i+"']",o).text(n.summary[i].format("0.00"))}function v(n,t){var i=n.getAttribute("data-status");t.counter[i]!=undefined&&t.counter[i].add(1),t.counter.all.add(1),t.summary.sum.add(n.getAttribute("data-ordersum")),t.summary.sumok.add(n.getAttribute("data-ordersumok")),t.summary.sumcash.add(n.getAttribute("data-orderpaycash")),t.summary.sumpoint.add(n.getAttribute("data-orderpoint"))}function k(){var i=$(this).attr("data-status"),n=y();i=="all"?(e.hide(),o.show(),$("li",t).show().each(function(t,i){v(i,n)})):t.find("li").each(function(t,r){r.getAttribute("data-status")==i?(r.style.display="list-item",v(r,n)):r.style.display="none"}),p(n),delete n}function c(n,t){if(h){t&&t();return}if(n||!(u>=s)){var i={d1:$("#txtOrderListBeginDate").val(),d2:$("#txtOrderListEndDate").val(),c:DataStorage.CompanyID(),p:u+1,q:g()};n&&(i.t=DataStorage.LatestUpdateOn()),h=!0,EleoooWrapper.GetOrders(i,function(r){r.code>-1?(u!=0||app.wsInited()||(DataStorage.LatestUpdateOn(r.data.orders.length>0?r.data.orders[0].OrderUpdateOn:i.d1),app.initWS()),l(r.data.orders,n),h=!1,n||(u++,s=r.data.pageCount),t&&t()):app.logInfo(r.message)})}}function d(){setTimeout(function(){c(!0,d)},5e3)}function g(){return val=i.val(),val==i.attr("defVal")?"":val}var t,f,i,e,o,u=0,s=1,h=!1,w={notstarted:"待处理",inprogress:"处理中",modified:"已修改",urge:"催餐中",canceled:"已取消",completed:"订餐成功"},r=n.prototype;r.visible=!1,r.onClose=function(n){if(!app.isDlgView(n)){var i={pageIndex:u,pageCount:s,html:t.html()};DataStorage.ViewCache("OrderList",i),t=!1,f.html(i.html).attr("data-pageIndex",i.pageIndex).attr("data-pageCount",i.pageCount)}},r.onLoad=function(n){if(!n){if(app.bindDateSelector("txtOrderListBeginDate"),app.bindDateSelector("txtOrderListEndDate"),t=$("#orderContainer"),e=$("#s1"),o=$("#s2"),$("a",e).tap(k),$("span",o).tap(function(){e.show(),o.hide()}),i=$("#txtOrderListUserPhone").focusin(function(){val=i.val(),val==i.attr("defVal")&&i.val("")}).focusout(function(){val=i.val(),val&&val.length!=0||i.val(i.attr("defVal"))}),i.val(i.attr("defVal")),f)t.html(f.html()),u=parseInt(f.attr("data-pageIndex")),s=parseInt(f.attr("data-pageCount")),a(t.find("li"));else{f=$("<ul><\/ul>");var r=JSON.parse(DataStorage.ViewCache("OrderList"));r&&(t.html(r.html),a(t.find("li")))}$(window).lazyload({load:c}),c(!1)}},r.onPushOrder=function(n){n.data.length>0&&(h=!0,l(n.data,!0),DataStorage.LatestUpdateOn(n.data[0].OrderUpdateOn),h=!1,n.hasNew&&r.visible==!1&&(app.notify("你有新的订单需要处理."),app.isCordovaApp()&&navigator.notification.beep(2)))},r.renderView=function(n){var t=(new Date).format("yyyy-MM-dd");n({beginDate:t,endDate:t})},r.refreshOrderList=function(){l(_dataCache)},r.showTempView=function(n){app.currentOrderId(n.attr("data-id")),app.showTempView()},r.showHandleView=function(n){app.currentOrderId(n.attr("data-id")),app.showOrderHandleView()},r.showOrderList=function(){s=1,u=0,c(!1)}},t=function(){function l(){var t,i=numeral(0),r=0,f,e;for(e in u)t=u[e],f=t.NewPrice||t.OrderPrice,t.IsCompanyItem&&r==0&&(r=t.OrderSum),i.add((t.IsCompanyItem?t.OrderQty-1:t.OrderQty)*f);n.OrderSumOk=i.add(r).round(2),delete i}function a(n,t){if(t){var i=numeral(t.NewPrice);i.valueOf()>=0?f[n]=t.MenuName+"价格调整为"+i.format("0.00")+"元":f[n]&&delete f[n],l(),s(),delete i}}function v(n,t){if(t){var i=t.IsOutOfStock;i?e[n]=t.MenuName:e[n]&&delete e[n],s()}}function s(){var f=h(),i=c(),e=$('input[value="1"]',r).attr("data-message",""),t="",u,o;f.length>0&&(u=numeral(n.OrderSumOk).add(n.ServiceSum),t="经餐厅确认："+f.join("，")+"，您的订单总计为"+u.format("0.00")+"元。",e.eq(1).attr("data-message",t).siblings("span").html(t),delete u),i.length>0&&(t="很抱歉，"+i.join("，")+"今天暂缺，请修改后重新下单。",o="很抱歉，"+n.CompanyName+"表示，"+i.join("，")+"今天暂缺，请修改后重新下单。",e.eq(0).attr("data-message",o).siblings("span").html(t))}function h(){var n=[],t;for(t in f)n.push(f[t]);return n}function c(){var n=[],t;for(t in e)n.push(e[t]);return n}var r=!1,u={},n={},i=t.prototype,f={},e={},o=!1;i.isDlgView=!0,i.changePrice=function(n){n=$(n);var i=n.attr("data-id"),f=parseFloat(n.val())||0,t=u[i];t&&(t.NewPrice=f,a(i,t),$('input[value="1"]',r).eq(1).attr("checked",!0))},i.outOfStock=function(n){var i=n.attr("data-id"),f=n.hasClass("green"),t=u[i];t&&(f?(t.IsOutOfStock=!0,n.addClass("red").removeClass("green")):(t.IsOutOfStock=!1,n.addClass("green").removeClass("red")),v(i,t),$('input[value="1"]',r).eq(0).attr("checked",!0))},i.selectMsn=function(n){n.find("input").attr("checked",!0)},i.onLoad=function(){r=$("#reviewContainer")},i.processItem=function(n){u[n.MenuId.toString()]=n},i.renderView=function(t){EleoooWrapper.OrderDetail(app.currentOrderId(),function(i){i.code==0?(n=i.data,t(n)):app.logError(i.message)})},i.confirmOrder=function(){var i,f,t,e;if(o){app.logInfo("正在发送,请稍等...");return}if(i=$('input[name="msnType"]:checked',r),f=i.val(),f=="1"&&h().length==0&&c().length==0){app.logInfo("你还没有调整价信息或缺货信息.");return}if(t=i.attr("data-message"),!t||t.length==0){app.logInfo("请输入回复内容.");return}e={orderId:n.OrderId,orderSessionVal:n.orderSessionVal,msnType:f,message:t,orders:JSON.stringify(u)},o=!0,EleoooWrapper.ConfirmOrder(e,function(t){app.logInfo(t.message),t.code==0&&(n.orderSessionVal=t.data.orderSessionVal),o=!1})},i.toggleReview=function(){r.toggle()}},i=function(){function h(n){var i,r;t&&(i=new FileUploadOptions,i.fileKey="voice",i.fileName=e,i.mimeType="media/mp3",i.params={id:app.currentOrderId(),m:n},r=new FileTransfer,r.upload(imageURI,encodeURI(EleoooWrapper.getUrl("SendOrderTemps")),function(n){t=!1;var i=JSON.parse(n.responseText);i.code>-1&&(f(i.data),$("#txtMessage").val(""))},function(n){app.logError(n.source)},i))}function o(n){t?h(n):EleoooWrapper.callServices("SendOrderTemps",{m:n,id:app.currentOrderId()},function(n){n.code<0?app.logError(n.message):(t=!1,f(n.data),$("#txtMessage").val(""))})}function f(n){var t=u.find("#_"+n.id);t.length>0?t.replaceWith(VT.TempItem(n)):u.append(VT.TempItem(n))}function c(n){for(var t=0;t<n.length;t++)f(n[t])}function s(i){if(!app.isCordovaApp()&&i){app.logError("暂不支持此操作.");return}i?n||(n=new Media(e),n.startRecord()):n&&(n.stopRecord(),t=n.getDuration()>=2,n.release(),n=!1)}function l(){EleoooWrapper.callServices("GetOrderTemps",{id:app.currentOrderId()},function(n){n.code==0&&(c(n.data.temps),$("#phone").text(n.data.MemberPhoneNumber),$("#timespan").text(n.data.Timespan))})}var r=i.prototype,u=!1,n=!1,e="voice.mp3",t=!1;r.isDlgView=!0,r.onLoad=function(){u=$("#tempContainer"),$("#recordVoice").bind("touchstart",function(){s(!0)}).bind("touchend",function(){s(!1)}),t=!1,l()},r.playVoice=function(n){app.play(n.attr("voice"))},r.sendMessage=function(){var n=$("#txtMessage").val();n&&n.length>0?o(n):$("#temp_review").toggle()},r.quickSend=function(n){o(n.text()),$("#temp_review").toggle()}};window.$_OrderList=n,window.$_OrderHandle=t,window.$_Temp=i}(window),function(){var n=function(){function e(){var n={t:4,b:DataStorage.CompanyID(),i:f+1,d1:$("#txtBeginDate").val(),d2:$("#txtEndDate").val()};EleoooWrapper.FacebookQuery(n,function(n){var s;if(n.code>-1){if(u.eq(0).text(n.data.good),u.eq(1).text(n.data.normal),u.eq(2).text(n.data.bad),n.data.html.length==0&&f==0)t.find("li").remove();else{var l=n.data.html.length/2,e=0,h=0,o="",r,c=i.attr("data-type");for(s=0;s<l;s++)h=n.data.html[e],o=n.data.html[e+1],r=t.find("#item"+h),r.length>0?r.replaceWith(o):(r=$(o),c!="All"&&c!=r.attr("data-reply")&&r.hide(),t.append(r)),e=e+2}f++}})}var t=!1,i=!1,u=!1,o=!1,f=0,r=n.prototype;r.onLoad=function(){t=$("#reviewList"),i=$("#mall_cate"),o=$(".deal_link"),u=$("#rw_number > i"),app.bindDateSelector("txtBeginDate"),app.bindDateSelector("txtEndDate"),i.parent().tap(function(){$(this).toggleClass("mall_on"),o.toggle()}),e(),t.lazyload({load:function(){app.logInfo("lazyload...."),e()}})},r.renderView=function(n){var t=(new Date).format("yyyy-MM-dd");n({beginDate:t,endDate:t})},r.showReview=function(){e()},r.filterReview=function(n){var f=n.attr("data-type"),o=n.text(),e,u,r;if(f=="All")t.find("li").show();else for(e=t.find("li"),u=0;u<e.length;u++)r=e.eq(u),r.attr("data-reply")==f?r.show():r.hide();n.attr("data-type",i.attr("data-type")).text(i.text()),i.attr("data-type",f).text(o).trigger("tap")},r.showReplyBox=function(n){$("#box"+n.attr("data-id"),t).toggle()},r.replyFaceBook=function(n){var i=$("#txtbox"+n.attr("data-id"),t).val(),r;if(!i||i.length==0){app.logInfo("请输入回复内容.");return}r={fbID:n.attr("data-id"),content:encodeURIComponent(i)},EleoooWrapper.ReplyFacebook(r,function(n){if(n.code>=0){var u=n.data.replace("[0]",i);$("#item"+r.fbID,t).append(u).find(".rw4,.rw5").remove(),app.logInfo("回复成功.")}else app.logInfo(n.message)})}};window.$_Review=n}(window)